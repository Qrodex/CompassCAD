<!DOCTYPE html>
<html lang="en">
    <head>
        <title>CompassCAD</title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="../styles/index.css">
        <link rel="stylesheet" href="../styles/theme.css">
        <script src="../js/jquery-min.js"></script>
    </head>
    <body>
        <div class="prompt hidden" id="prompt-container">
            <h3 id="prompt-message">Enter Prompt</h3>
            <br>
            <input type="text" id="prompt-input" placeholder="Please enter text">
            <br>
            <div class="prompt-answer">
                <button id="prompt-ok">OK</button>
                <button id="prompt-cancel">Cancel</button>
            </div>
        </div>
        <header class="menubar" id="menubar">
            <div class="menubar-branding">
                <img src="../../assets/logos/512x512.png" width="20" alt="Sunset Logo">
            </div>
            <div class="menubar-centered">
                <small id="titlething">New Design 1 - CompassCAD</small>
            </div>
            <div class="window-actions">
                <button onclick="redirectToSomewhere(`https://afsc.org/news/6-ways-you-can-support-palestinians-gaza`)" title="Consider supporting Palestine"><img src="../../assets/icons/supportive.svg"></button>
                <button id="minimize" title="Minimize"><img src="../../assets/icons/minimize.svg"></button>
                <button id="maximize" title="Maximize"><img src="../../assets/icons/maximize.svg"></button>
                <button id="close" title="Close"><img src="../../assets/icons/close.svg"></button>
            </div>
        </header>
        <div class="main-content">
            <div class="toolbar" id="toolbar">
                <button title="New Design (ctrl+n)" id="new-design"><img src="../../assets/icons/newLogic.svg"></button>
                <button title="Open Design (ctrl+o)" id="open-design"><img src="../../assets/icons/openLogic.svg"></button>
                <button title="Save Design (ctrl+s)" id="save-design"><img src="../../assets/icons/saveLogic.svg"></button>
                <div class="division-line"></div>
                <button title="Undo (ctrl+z)" id="undo"><img src="../../assets/icons/undo.svg"></button>
                <button title="Redo (ctrl+y)" id="redo"><img src="../../assets/icons/redo.svg"></button>
            </div>
            <div class="container">
                <div class="quick-tool" id="quick-tool">
                    <button title="Navigate (q)" id="navigate"><img src="../../assets/icons/navigate.svg"></button>
                    <button title="Move Object (e)" id="move-obj"><img src="../../assets/icons/move.svg"></button>
                    <button title="Delete Object (t)" id="del-obj"><img src="../../assets/icons/delete.svg"></button>
                    <button title="Add Point (a)" id="add-point"><img src="../../assets/icons/point.svg"></button>
                    <button title="Add Line (s)" id="add-line"><img src="../../assets/icons/line.svg"></button>
                    <button title="Add Circle (d)" id="add-circle"><img src="../../assets/icons/circle.svg"></button>
                    <button title="Add Arc (f)" id="add-arc"><img src="../../assets/icons/arc.svg"></button>
                    <button title="Add Rectangle (g)" id="add-rect"><img src="../../assets/icons/rectangle.svg"></button>
                    <button title="Add Text (h)" id="add-label"><img src="../../assets/icons/text.svg"></button>
                    <button title="Add Vertical Barrel (j)" id="add-barrel"><img src="../../assets/icons/vertical-barrel.svg"></button>
                    <button title="Add Tree (k)" id="add-tree"><img src="../../assets/icons/tree.svg"></button>
                    <button title="Measure (z)" id="ruler"><img src="../../assets/icons/measure.svg"></button>
                </div>
                <div class="canvas-container">
                    <canvas id="canvas" width="800" height="600" oncontextmenu="return false"></canvas>
                </div>
            </div>
            <footer class="status-bar" id="status">
                <p id="status-stuff">Welcome to CompassCAD</p>
            </footer>
        </div>
        <script src="../js/WindowHandling.js"></script>
        <script src="../js/LinkToShell.js"></script>
        <script src="../js/core/ComponentHandler.js"></script>
        <script src="../js/core/MiscellaneousShapes.js"></script>
        <script src="../js/core/LogicDisplay.js"></script>
        <script src="../js/core/InputHandler.js"></script>
        <script src="../js/core/GraphicsRenderer.js"></script>
        <script src="../js/Utils.js"></script>
        <script>
            $(document).ready(() => {
                
                const renderer = new GraphicDisplay('canvas', 800,600)
                const resizeWin = () => {
                    var resultedHeight = document.getElementById('menubar').offsetHeight + document.getElementById('toolbar').offsetHeight + document.getElementById('status').offsetHeight + 10
                    renderer.displayHeight = window.innerHeight - resultedHeight
                    renderer.displayWidth = window.innerWidth - document.getElementById('quick-tool').offsetWidth
                    document.getElementById('canvas').width = window.innerWidth - document.getElementById('quick-tool').offsetWidth
                    document.getElementById('canvas').height = window.innerHeight - resultedHeight
                }
                const keyBindings = {
                    'q': 'navigate',
                    'Escape': 'navigate',
                    'e': 'move-obj',
                    't': 'del-obj',
                    'a': 'add-point',
                    's': 'add-line',
                    'd': 'add-circle',
                    'f': 'add-arc',
                    'g': 'add-rect',
                    'h': 'add-label',
                    'j': 'add-barrel',
                    'k': 'add-tree',
                    'z': 'ruler'
                };
                resizeWin()
                window.onresize = resizeWin
                renderer.unitMeasure = 'm'
                renderer.unitConversionFactor = 1/100
                renderer.showOrigin = false
                document.getElementById('navigate').onclick = () => {
                    console.log('Navigate button clicked');
                    renderer.setMode(renderer.MODES.NAVIGATE)
                };

                document.getElementById('move-obj').onclick = () => {
                    console.log('Move Object button clicked');
                    renderer.setMode(renderer.MODES.MOVE)
                };

                document.getElementById('del-obj').onclick = () => {
                    console.log('Delete Object button clicked');
                    renderer.setMode(renderer.MODES.DELETE)
                };

                document.getElementById('add-point').onclick = () => {
                    console.log('Add Point button clicked');
                    renderer.setMode(renderer.MODES.ADDPOINT)
                };

                document.getElementById('add-line').onclick = () => {
                    console.log('Add Line button clicked');
                    renderer.setMode(renderer.MODES.ADDLINE)
                };

                document.getElementById('add-circle').onclick = () => {
                    console.log('Add Circle button clicked');
                    renderer.setMode(renderer.MODES.ADDCIRCLE)
                };

                document.getElementById('add-arc').onclick = () => {
                    console.log('Add Arc button clicked');
                    renderer.setMode(renderer.MODES.ADDARC)
                };

                document.getElementById('add-rect').onclick = () => {
                    console.log('Add Rectangle button clicked');
                    renderer.setMode(renderer.MODES.ADDRECTANGLE)
                };

                document.getElementById('add-label').onclick = () => {
                    console.log('Add Text button clicked');
                    renderer.setMode(renderer.MODES.ADDLABEL)
                };

                document.getElementById('add-barrel').onclick = () => {
                    console.log('Add Vertical Barrel button clicked');
                    renderer.setModeShape(CreateVerticalBarrel)
                };

                document.getElementById('add-tree').onclick = () => {
                    console.log('Add Tree button clicked');
                    renderer.setModeShape(PlantATree)
                };

                document.getElementById('ruler').onclick = () => {
                    console.log('Measure button clicked');
                    renderer.setMode(renderer.MODES.ADDMEASURE)
                };
                document.getElementById('new-design').onclick = () => {
                    if (confirm('Are you sure? You are going to lose your design!') == true)
                        renderer.createNew()
                    else
                        return
                }
                document.getElementById('undo').onclick = () => {
                    renderer.undo()
                }
                document.getElementById('redo').onclick = () => {
                    renderer.redo()
                }
                document.getElementById('open-design').onclick = () => {
                    renderer.openDesign()
                }
                document.getElementById('save-design').onclick = () => {
                    renderer.saveDesign()
                }

                document.addEventListener('keydown', (event) => {
                    console.log('Key down')
                    const elementId = keyBindings[event.key];
                    if (elementId) {
                        const element = document.getElementById(elementId);
                        if (element) {
                            console.log(`Key "${event.key}" pressed, emulating click on ${elementId}`);
                            element.click();
                        }
                    }
                });

                initCAD(renderer)
            })
        </script>
    </body>
</html>